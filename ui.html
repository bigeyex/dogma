<!DOCTYPE html>
<html>

<head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      padding: 16px;
      min-height: 100vh;
    }

    h2 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #fff;
    }

    .description {
      font-size: 12px;
      color: #888;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    textarea {
      width: 100%;
      height: 240px;
      background: #0f0f1a;
      border: 1px solid #333;
      border-radius: 8px;
      color: #e0e0e0;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 11px;
      padding: 12px;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s;
    }

    textarea:focus {
      border-color: #3b82f6;
    }

    textarea::placeholder {
      color: #555;
    }

    .controls {
      display: flex;
      margin-bottom: 12px;
      gap: 16px;
      align-items: center;
    }

    .toggle-group {
      display: flex;
      background: #0f0f1a;
      padding: 2px;
      border-radius: 6px;
      border: 1px solid #333;
    }

    .toggle-group label {
      cursor: pointer;
      padding: 6px 12px;
      font-size: 12px;
      color: #888;
      border-radius: 4px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .toggle-group input[type="radio"] {
      display: none;
    }

    .toggle-group input[type="radio"]:checked+label {
      background: #333;
      color: #fff;
      font-weight: 500;
    }

    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    button {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    #convert {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
    }

    #convert:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    #cancel {
      background: #333;
      color: #ccc;
    }

    #cancel:hover {
      background: #444;
    }

    .supported {
      margin-top: 16px;
      padding: 12px;
      background: #0f0f1a;
      border-radius: 6px;
      font-size: 11px;
    }

    .supported h3 {
      font-size: 11px;
      color: #888;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .supported ul {
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 4px 8px;
    }

    .supported li {
      color: #666;
      font-size: 10px;
    }

    .tag {
      display: inline-block;
      padding: 2px 6px;
      background: #252538;
      border-radius: 4px;
      font-family: monospace;
      color: #8b5cf6;
    }
  </style>
</head>

<body>
  <h2>Tailwind HTML ‚Üí Figma</h2>
  <p class="description">Paste HTML with Tailwind classes. Supports <span class="tag">tailwind.config</span>.</p>

  <div class="controls">
    <div class="toggle-group">
      <input type="radio" id="mobile" name="viewport" value="mobile" checked>
      <label for="mobile">üì± Mobile (375px)</label>

      <input type="radio" id="desktop" name="viewport" value="desktop">
      <label for="desktop">üñ•Ô∏è Desktop (1440px)</label>
    </div>
  </div>

  <textarea id="html-input"
    placeholder="<div class=&quot;flex flex-col gap-4 p-6 bg-gray-900&quot;>...</div>"></textarea>

  <div class="buttons">
    <button id="convert">Convert to Figma</button>
    <button id="cancel">Cancel</button>
  </div>



  <script>
    document.getElementById('convert').onclick = async () => {
      const textarea = document.getElementById('html-input');
      const html = textarea.value;
      const viewport = document.querySelector('input[name="viewport"]:checked').value;

      // Scan for Font Awesome icons
      const iconMap = {};
      // Match anything that looks like a Font Awesome icon class: fa, fas, far, fab, fa-something
      const faRegex = /class=["']([^"']*\bfa[-a-z0-9]*\b[^"']*)["']/g;
      const matches = [...html.matchAll(faRegex)];

      const fetchIcon = async (className) => {
        // Determine style
        let style = 'solid';
        if (className.includes('far') || className.includes('fa-regular')) style = 'regular';
        else if (className.includes('fab') || className.includes('fa-brands')) style = 'brands';
        else if (className.includes('fal') || className.includes('fa-light')) style = 'light';
        else if (className.includes('fat') || className.includes('fa-thin')) style = 'thin';

        // Extract all fa-icon-name classes
        const iconMatches = className.matchAll(/\bfa-([a-z0-9-]+)\b/g);
        for (const iconMatch of iconMatches) {
          const iconName = iconMatch[1];
          // Skip utility classes
          if (['solid', 'regular', 'brands', 'light', 'thin', 'duotone', 'xs', 'sm', 'lg', 'xl', '2xl', 'fw', '2xs', '3x', '4x', '5x', '6x', '7x', '8x', '9x', '10x'].includes(iconName)) continue;

          const key = `${style}/${iconName}`;
          if (iconMap[key]) continue;

          try {
            // Using 6.x branch as suggested by research
            const url = `https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/${style}/${iconName}.svg`;
            const response = await fetch(url);
            if (response.ok) {
              iconMap[key] = await response.text();
            } else if (style !== 'solid') {
              // Fallback to solid if regular/light fails
              const fallbackUrl = `https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/${iconName}.svg`;
              const fallbackRes = await fetch(fallbackUrl);
              if (fallbackRes.ok) {
                iconMap[key] = await fallbackRes.text();
              }
            }
          } catch (e) {
            console.error(`Failed to fetch icon ${key}:`, e);
          }
        }
      };

      const iconPromises = matches.map(match => fetchIcon(match[1]));
      await Promise.all(iconPromises);

      parent.postMessage({ pluginMessage: { type: 'convert-html', html, viewport, icons: iconMap } }, '*');
    };

    document.getElementById('cancel').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    };
  </script>
</body>

</html>