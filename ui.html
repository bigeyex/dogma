<!DOCTYPE html>
<html>

<head>
  <style>
    /* ============================================================================
   RESET & BASE STYLES
   ============================================================================ */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #1a1a2e;
    color: #e0e0e0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* ============================================================================
   TABS & NAVIGATION
   ============================================================================ */
.tabs {
    display: flex;
    background: #121225;
    padding: 0 8px;
    border-bottom: 1px solid #333;
}

.tab {
    padding: 12px 16px;
    font-size: 13px;
    color: #888;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
}

.tab:hover {
    color: #ccc;
}

.tab.active {
    color: #fff;
    border-bottom-color: #3b82f6;
}

.tab-content {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
    display: none;
}

.tab-content.active {
    display: block;
}

/* ============================================================================
   TYPOGRAPHY & FORMS
   ============================================================================ */
h2 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #fff;
}

.description {
    font-size: 12px;
    color: #888;
    margin-bottom: 12px;
    line-height: 1.4;
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    font-size: 12px;
    color: #888;
    margin-bottom: 6px;
}

input[type="text"],
input[type="password"],
select,
textarea {
    width: 100%;
    background: #0f0f1a;
    border: 1px solid #333;
    border-radius: 8px;
    color: #e0e0e0;
    font-size: 12px;
    padding: 10px;
    outline: none;
    transition: border-color 0.2s;
}

textarea {
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 11px;
    resize: vertical;
    min-height: 120px;
}

textarea#html-input {
    height: 200px;
}

input:focus,
select:focus,
textarea:focus {
    border-color: #3b82f6;
}

/* ============================================================================
   REFERENCE LIST STYLES
   ============================================================================ */
.ref-list-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 8px;
    align-items: center;
}

.ref-items {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.ref-item {
    background: #2a2a4a;
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 11px;
    color: #ccc;
    display: flex;
    align-items: center;
    gap: 4px;
    border: 1px solid #333;
}

.ref-item .remove-btn {
    cursor: pointer;
    color: #888;
    display: flex;
    align-items: center;
}

.ref-item .remove-btn:hover {
    color: #ef4444;
}

.add-ref-btn {
    background: #2a2a4a;
    color: #ccc;
    border: 1px dashed #444;
    border-radius: 4px;
    padding: 2px 8px;
    font-size: 11px;
    height: 22px;
    width: auto;
    flex: none;
    transition: all 0.2s;
}

.add-ref-btn:hover {
    border-color: #3b82f6;
    color: #fff;
    background: #333355;
}

.add-ref-btn svg {
    margin-right: 2px;
}

/* ============================================================================
   CONTROLS & TOGGLES
   ============================================================================ */
.controls {
    display: flex;
    margin-bottom: 12px;
    gap: 16px;
    align-items: center;
}

.toggle-group {
    display: flex;
    background: #0f0f1a;
    padding: 2px;
    border-radius: 6px;
    border: 1px solid #333;
}

.toggle-group label {
    cursor: pointer;
    padding: 6px 12px;
    font-size: 12px;
    color: #888;
    border-radius: 4px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.toggle-group input[type="radio"] {
    display: none;
}

.toggle-group input[type="radio"]:checked+label {
    background: #333;
    color: #fff;
    font-weight: 500;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 12px;
    color: #888;
}

.checkbox-group input {
    cursor: pointer;
}

/* ============================================================================
   BUTTONS
   ============================================================================ */
.btn-group {
    display: flex;
    gap: 8px;
    margin-top: 12px;
}

button {
    flex: 1;
    padding: 10px 16px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-primary {
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    color: white;
}

.btn-primary:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

.btn-secondary {
    background: #333;
    color: #ccc;
}

.btn-secondary:hover:not(:disabled) {
    background: #444;
}

/* ============================================================================
   STATUS & FEEDBACK
   ============================================================================ */
.status {
    margin-top: 12px;
    font-size: 11px;
    color: #888;
    text-align: center;
    min-height: 1.2em;
}

.thinking-container {
    display: none;
    margin-top: 12px;
    font-size: 11px;
    color: #888;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: 1.2em;
}

.thinking-container.active {
    display: flex;
}

#thinking-status {
    color: #888;
}

#token-counter {
    color: #888;
    font-feature-settings: "tnum";
    font-variant-numeric: tabular-nums;
}

.spinner {
    width: 14px;
    height: 14px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s linear infinite;
    display: none;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

button.loading .spinner {
    display: block;
}
  </style>
</head>

<body>
  <div class="tabs">
    <div class="tab active" data-tab="builder">Builder</div>
    <div class="tab" data-tab="tailwind">Tailwind</div>
    <div class="tab" data-tab="settings">Settings</div>
  </div>

  <!-- Builder Tab -->
  <div id="builder-tab" class="tab-content active">
    <h2>AI Builder</h2>
    <p class="description">AI will generate Tailwind HTML based on your prompt.</p>

    <div class="form-group">
      <div id="ref-list-container" class="ref-list-container">
        <div id="ref-items"></div>
        <button id="add-ref-btn" class="add-ref-btn" title="Add selected frame as style reference">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Ref Style
        </button>
      </div>
      <textarea id="prompt-input"
        placeholder="e.g. A premium landing page hero section with a dark theme, a vibrant call-to-action button, and a feature list."></textarea>
    </div>

    <div class="controls">
      <div class="toggle-group">
        <input type="radio" id="builder-mobile" name="builder-viewport" value="mobile" checked>
        <label for="builder-mobile">üì± Mobile</label>

        <input type="radio" id="builder-desktop" name="builder-viewport" value="desktop">
        <label for="builder-desktop">üñ•Ô∏è Desktop</label>
      </div>

      <label class="checkbox-group">
        <input type="checkbox" id="thinking-checkbox" checked>
        <span data-i18n="thinkingLabel">Thinking(Ê∑±Â∫¶ÊÄùËÄÉ)</span>
      </label>

      <div id="copy-btn" title="Copy generated code"
        style="display: none; margin-left: auto; cursor: pointer; color: #888; align-items: center; transition: color 0.2s;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      </div>
    </div>

    <div class="btn-group">
      <button id="build-btn" class="btn-primary">
        <span class="spinner"></span>
        Build in Figma
      </button>
      <button id="expand-btn" class="btn-secondary">
        <span class="spinner"></span>
        Expand
      </button>
    </div>
    <div id="builder-status" class="status"></div>

    <div id="thinking-container" class="thinking-container">
      <div id="thinking-status">AI is thinking...</div>
      <div id="token-counter">0 tokens</div>
      <a id="stop-btn" class="stop-link"
        style="color: #ef4444; cursor: pointer; font-size: 11px; margin-left: 12px; text-decoration: none;">Stop</a>
    </div>
  </div>

  <!-- Tailwind Tab -->
  <div id="tailwind-tab" class="tab-content">
    <h2>Tailwind ‚Üí Figma</h2>
    <p class="description">Convert existing Tailwind HTML to Figma layers.</p>

    <div class="controls">
      <div class="toggle-group">
        <input type="radio" id="mobile" name="viewport" value="mobile" checked>
        <label for="mobile">üì± Mobile</label>

        <input type="radio" id="desktop" name="viewport" value="desktop">
        <label for="desktop">üñ•Ô∏è Desktop</label>
      </div>
    </div>

    <textarea id="html-input"
      placeholder="<div class=&quot;flex flex-col gap-4 p-6 bg-gray-900&quot;>...</div>"></textarea>

    <div class="btn-group">
      <button id="convert" class="btn-primary">Convert</button>
      <button id="figma-to-tailwind-btn" class="btn-secondary">Figma ‚Üí Tailwind</button>
    </div>
    <div id="tailwind-status" class="status"></div>
  </div>

  <!-- Settings Tab -->
  <div id="settings-tab" class="tab-content">
    <h2>Settings</h2>
    <p class="description">Configure your VolcEngine Ark credentials.</p>

    <div class="form-group">
      <label data-i18n="language">Language</label>
      <select id="language">
        <option value="zh-CN">üá®üá≥ ‰∏≠Êñá</option>
        <option value="en-US">üá∫üá∏ English</option>
      </select>
    </div>

    <div class="form-group">
      <label data-i18n="provider">Provider</label>
      <select id="provider">
        <option value="volcengine">VolcEngine (Ark)</option>
      </select>
    </div>

    <div class="form-group">
      <label data-i18n="chatModelId">Chat Model ID (for Expand)</label>
      <input type="text" id="chat-model-id" placeholder="doubao-seed-1-8-251228" value="doubao-seed-1-8-251228">
    </div>

    <div class="form-group">
      <label data-i18n="codingModelId">Coding Model ID (for Builder)</label>
      <input type="text" id="coding-model-id" placeholder="doubao-seed-code-preview-251028"
        value="doubao-seed-code-preview-251028">
    </div>

    <div class="form-group">
      <label data-i18n="apiKey">API Key</label>
      <input type="password" id="api-key" placeholder="Enter your API key">
    </div>

    <div class="btn-group">
      <button id="save-settings" class="btn-primary" data-i18n="saveSettings">Save Settings</button>
    </div>
    <div id="settings-status" class="status"></div>
  </div>

  <script>
    "use strict";
(() => {
  var __getOwnPropNames = Object.getOwnPropertyNames;
  var __esm = (fn, res) => function __init() {
    return fn && (res = (0, fn[__getOwnPropNames(fn)[0]])(fn = 0)), res;
  };
  var __commonJS = (cb, mod) => function __require() {
    return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
  };
  var __async = (__this, __arguments, generator) => {
    return new Promise((resolve, reject) => {
      var fulfilled = (value) => {
        try {
          step(generator.next(value));
        } catch (e) {
          reject(e);
        }
      };
      var rejected = (value) => {
        try {
          step(generator.throw(value));
        } catch (e) {
          reject(e);
        }
      };
      var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
      step((generator = generator.apply(__this, __arguments)).next());
    });
  };

  // src/ui/i18n.ts
  function updateUI(settings) {
    const lang = settings.language || "zh-CN";
    const t = translations[lang];
    document.querySelector('[data-tab="builder"]').textContent = t.builderTab;
    document.querySelector('[data-tab="tailwind"]').textContent = t.tailwindTab;
    document.querySelector('[data-tab="settings"]').textContent = t.settingsTab;
    document.querySelector("#builder-tab h2").textContent = t.aiBuilderTitle;
    document.querySelector("#builder-tab .description").textContent = t.aiBuilderDesc;
    document.getElementById("prompt-input").placeholder = t.promptPlaceholder;
    document.querySelector('label[for="builder-mobile"]').textContent = t.mobile;
    document.querySelector('label[for="builder-desktop"]').textContent = t.desktop;
    document.querySelector("#build-btn").childNodes[2].textContent = t.buildBtn;
    document.querySelector("#expand-btn").childNodes[2].textContent = t.expandBtn;
    document.getElementById("stop-btn").textContent = t.stopBtn;
    document.getElementById("thinking-status").textContent = t.aiThinking;
    document.getElementById("token-counter").textContent = `0 ${t.tokens}`;
    const thinkingLabelSpan = document.querySelector("label.checkbox-group span");
    if (thinkingLabelSpan) thinkingLabelSpan.textContent = t.thinkingLabel;
    const addRefBtn = document.getElementById("add-ref-btn");
    if (addRefBtn) {
      addRefBtn.childNodes[2].textContent = t.refStyle;
    }
    document.querySelector("#tailwind-tab h2").textContent = t.tailwindTitle;
    document.querySelector("#tailwind-tab .description").textContent = t.tailwindDesc;
    document.querySelector('label[for="mobile"]').textContent = t.mobile;
    document.querySelector('label[for="desktop"]').textContent = t.desktop;
    document.getElementById("html-input").placeholder = t.htmlPlaceholder;
    document.getElementById("convert").textContent = t.convertBtn;
    document.getElementById("figma-to-tailwind-btn").textContent = t.figmaToTailwind;
    document.querySelector("#settings-tab h2").textContent = t.settingsTitle;
    document.querySelector("#settings-tab .description").textContent = t.settingsDesc;
    document.querySelector('label[data-i18n="language"]').textContent = t.language;
    document.querySelector('label[data-i18n="provider"]').textContent = t.provider;
    document.querySelector('label[data-i18n="chatModelId"]').textContent = t.chatModelId;
    document.querySelector('label[data-i18n="codingModelId"]').textContent = t.codingModelId;
    document.querySelector('label[data-i18n="apiKey"]').textContent = t.apiKey;
    document.getElementById("save-settings").textContent = t.saveSettings;
  }
  var translations;
  var init_i18n = __esm({
    "src/ui/i18n.ts"() {
      "use strict";
      translations = {
        "zh-CN": {
          builderTab: "\u6784\u5EFA\u5668",
          tailwindTab: "Tailwind",
          settingsTab: "\u8BBE\u7F6E",
          aiBuilderTitle: "AI \u6784\u5EFA\u5668",
          aiBuilderDesc: "AI \u5C06\u6839\u636E\u60A8\u7684\u63CF\u8FF0\u751F\u6210 Tailwind HTML\u3002",
          promptPlaceholder: "\u4F8B\u5982\uFF1A\u4E00\u4E2A\u5E26\u6709\u6DF1\u8272\u4E3B\u9898\u3001\u9192\u76EE\u7684\u53F7\u53EC\u6027\u7528\u8BED\u6309\u94AE\u548C\u529F\u80FD\u5217\u8868\u7684\u9AD8\u7EA7\u7740\u9646\u9875\u82F1\u96C4\u90E8\u5206\u3002",
          mobile: "\u{1F4F1} \u624B\u673A",
          desktop: "\u{1F5A5}\uFE0F \u684C\u9762",
          buildBtn: "\u5728 Figma \u4E2D\u6784\u5EFA",
          expandBtn: "\u5C55\u5F00\u63CF\u8FF0",
          stopBtn: "\u505C\u6B62",
          tailwindTitle: "Tailwind \u2192 Figma",
          tailwindDesc: "\u7C98\u8D34\u8C46\u5305\u5E94\u7528\u751F\u6210\u7684\u4EE3\u7801\uFF0C\u8F6C\u6362\u4E3AFigma\u8BBE\u8BA1\u7A3F\u3002",
          htmlPlaceholder: '<div class="flex flex-col gap-4 p-6 bg-gray-900">...</div>',
          convertBtn: "\u8F6C\u6362",
          figmaToTailwind: "Figma \u2192 Tailwind",
          selectFrame: "\u8BF7\u5148\u9009\u4E2D\u4E00\u4E2A\u56FE\u5C42",
          converting: "\u8F6C\u6362\u4E2D...",
          settingsTitle: "\u8BBE\u7F6E",
          settingsDesc: "\u914D\u7F6E\u60A8\u7684\u706B\u5C71\u5F15\u64CE Ark \u51ED\u636E\u3002",
          language: "\u8BED\u8A00",
          provider: "\u63D0\u4F9B\u5546",
          chatModelId: "\u804A\u5929\u6A21\u578B ID (\u7528\u4E8E\u5C55\u5F00)",
          codingModelId: "\u7F16\u7801\u6A21\u578B ID (\u7528\u4E8E\u6784\u5EFA)",
          apiKey: "API \u5BC6\u94A5",
          saveSettings: "\u4FDD\u5B58\u8BBE\u7F6E",
          settingsSaved: "\u2713 \u8BBE\u7F6E\u5DF2\u4FDD\u5B58",
          processingIcons: "\u6B63\u5728\u5904\u7406\u56FE\u6807...",
          sentToFigma: "\u2713 \u5DF2\u53D1\u9001\u5230 Figma",
          enterDescription: "\u8BF7\u8F93\u5165\u63CF\u8FF0\u3002",
          setApiKey: "\u8BF7\u5728\u8BBE\u7F6E\u6807\u7B7E\u9875\u4E2D\u8BBE\u7F6E API \u5BC6\u94A5\u3002",
          expandingPrompt: "\u6B63\u5728\u5C55\u5F00\u63CF\u8FF0...",
          expanded: "\u2713 \u5DF2\u5C55\u5F00\uFF01",
          stoppedByUser: "\u7528\u6237\u5DF2\u505C\u6B62\u3002",
          contactingAI: "\u6B63\u5728\u8054\u7CFB AI...",
          buildingLayers: "\u6B63\u5728\u6784\u5EFA Figma \u56FE\u5C42...",
          buildComplete: "\u2713 \u6784\u5EFA\u5B8C\u6210\uFF01",
          generationStopped: "\u751F\u6210\u5DF2\u7531\u7528\u6237\u505C\u6B62\u3002",
          errorPrefix: "\u9519\u8BEF: ",
          tokens: "\u4EE4\u724C",
          aiThinking: "AI \u6B63\u5728\u601D\u8003...",
          generating: "\u6B63\u5728\u751F\u6210...",
          thinkingLabel: "\u6DF1\u5EA6\u601D\u8003",
          refStyle: "\u53C2\u8003\u6837\u5F0F",
          uploadingImage: "\u6B63\u5728\u4E0A\u4F20\u56FE\u7247...",
          noFrameSelected: "\u8BF7\u5148\u9009\u4E2D\u4E00\u4E2A\u56FE\u5C42 (Frame)",
          refAdded: "\u5DF2\u6DFB\u52A0\u53C2\u8003"
        },
        "en-US": {
          builderTab: "Builder",
          tailwindTab: "Tailwind",
          settingsTab: "Settings",
          aiBuilderTitle: "AI Builder",
          aiBuilderDesc: "AI will generate Tailwind HTML based on your prompt.",
          promptPlaceholder: "e.g. A premium landing page hero section with a dark theme, a vibrant call-to-action button, and a feature list.",
          mobile: "\u{1F4F1} Mobile",
          desktop: "\u{1F5A5}\uFE0F Desktop",
          buildBtn: "Build in Figma",
          expandBtn: "Expand",
          stopBtn: "Stop",
          tailwindTitle: "Tailwind \u2192 Figma",
          tailwindDesc: "Convert existing Tailwind HTML to Figma layers.",
          htmlPlaceholder: '<div class="flex flex-col gap-4 p-6 bg-gray-900">...</div>',
          convertBtn: "Convert",
          figmaToTailwind: "Figma \u2192 Tailwind",
          selectFrame: "Please select a frame",
          converting: "Converting...",
          settingsTitle: "Settings",
          settingsDesc: "Configure your VolcEngine Ark credentials.",
          language: "Language",
          provider: "Provider",
          chatModelId: "Chat Model ID (for Expand)",
          codingModelId: "Coding Model ID (for Builder)",
          apiKey: "API Key",
          saveSettings: "Save Settings",
          settingsSaved: "\u2713 Settings saved",
          processingIcons: "Processing icons...",
          sentToFigma: "\u2713 Sent to Figma",
          enterDescription: "Please enter a description.",
          setApiKey: "Please set API Key in Settings tab.",
          expandingPrompt: "Expanding prompt...",
          expanded: "\u2713 Expanded!",
          stoppedByUser: "Stopped by user.",
          contactingAI: "Contacting AI...",
          buildingLayers: "Building Figma layers...",
          buildComplete: "\u2713 Build complete!",
          generationStopped: "Generation stopped by user.",
          errorPrefix: "Error: ",
          tokens: "tokens",
          aiThinking: "AI is thinking...",
          generating: "Generating...",
          thinkingLabel: "Thinking",
          refStyle: "Ref Style",
          uploadingImage: "Uploading image...",
          noFrameSelected: "Please select a frame",
          refAdded: "Reference added"
        }
      };
    }
  });

  // src/ui/ui-icons.ts
  var getIconsMap;
  var init_ui_icons = __esm({
    "src/ui/ui-icons.ts"() {
      "use strict";
      getIconsMap = (html) => __async(null, null, function* () {
        const iconMap = {};
        const faRegex = /class=["']([^"']*\bfa[-a-z0-9]*\b[^"']*)["']/g;
        const matches = Array.from(html.matchAll(faRegex));
        const fetchIcon = (className) => __async(null, null, function* () {
          const iconMatches = Array.from(className.matchAll(/\bfa-([a-z0-9-]+)\b/g));
          for (const iconMatch of iconMatches) {
            const iconName = iconMatch[1];
            if (["fa", "solid", "regular", "brands", "light", "thin", "duotone", "xs", "sm", "lg", "xl", "2xl", "fw", "2xs", "3x", "4x", "5x", "6x", "7x", "8x", "9x", "10x", "spin", "pulse", "stack", "inverse"].includes(iconName)) continue;
            let version = "4.7.0";
            let style = "solid";
            if (className.includes("fa-solid") || className.includes("fas")) {
              style = "solid";
              version = "6.x";
            } else if (className.includes("fa-regular") || className.includes("far")) {
              style = "regular";
              version = "6.x";
            } else if (className.includes("fa-brands") || className.includes("fab")) {
              style = "brands";
              version = "6.x";
            } else if (className.includes("fa-light") || className.includes("fal")) {
              style = "light";
              version = "6.x";
            } else if (className.includes("fa-thin") || className.includes("fat")) {
              style = "thin";
              version = "6.x";
            }
            const key = version === "4.7.0" ? `fa4/${iconName}` : `${style}/${iconName}`;
            if (iconMap[key]) continue;
            try {
              let url;
              if (version === "4.7.0") {
                url = `https://raw.githubusercontent.com/encharm/font-awesome-svg-png/master/black/svg/${iconName}.svg`;
              } else {
                url = `https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/${style}/${iconName}.svg`;
              }
              const response = yield fetch(url);
              if (response.ok) {
                iconMap[key] = yield response.text();
              } else if (version === "6.x" && style !== "solid") {
                const fallbackUrl = `https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/${iconName}.svg`;
                const fallbackRes = yield fetch(fallbackUrl);
                if (fallbackRes.ok) {
                  iconMap[key] = yield fallbackRes.text();
                }
              } else if (version === "4.7.0") {
                const fallbackUrl = `https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/${iconName}.svg`;
                const fallbackRes = yield fetch(fallbackUrl);
                if (fallbackRes.ok) {
                  iconMap[key] = yield fallbackRes.text();
                }
              }
            } catch (e) {
              console.error(`Failed to fetch icon ${iconName}:`, e);
            }
          }
        });
        yield Promise.all(matches.map((match) => fetchIcon(match[1])));
        return iconMap;
      });
    }
  });

  // src/ui/main.ts
  var require_main = __commonJS({
    "src/ui/main.ts"(exports) {
      init_i18n();
      init_ui_icons();
      var settings = {
        provider: "volcengine",
        chatModelId: "doubao-seed-1-8-251228",
        codingModelId: "doubao-seed-code-preview-251028",
        apiKey: "",
        language: "zh-CN",
        thinking: true
      };
      var styleRefs = [];
      var abortController = null;
      var lastGeneratedCode = "";
      var tabs = document.querySelectorAll(".tab");
      var tabContents = document.querySelectorAll(".tab-content");
      tabs.forEach((tab) => {
        tab.onclick = () => {
          tabs.forEach((t) => t.classList.remove("active"));
          tabContents.forEach((c) => c.classList.remove("active"));
          tab.classList.add("active");
          const tabId = tab.dataset.tab;
          document.getElementById(`${tabId}-tab`).classList.add("active");
        };
      });
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (!msg) return;
        if (msg.type === "tailwind-result") {
          const status = document.getElementById("tailwind-status");
          const t = translations[settings.language];
          if (msg.error === "no-selection") {
            status.textContent = t.selectFrame;
          } else {
            document.getElementById("html-input").value = msg.html || "";
            status.textContent = "";
          }
          return;
        }
        if (msg.type === "load-settings" && msg.settings) {
          settings = Object.assign({}, settings, msg.settings);
          if (!settings.language) settings.language = "zh-CN";
          if (!settings.chatModelId) settings.chatModelId = msg.settings.modelId || "doubao-seed-1-8-251228";
          if (!settings.codingModelId) settings.codingModelId = "doubao-seed-code-preview-251028";
          document.getElementById("language").value = settings.language;
          document.getElementById("provider").value = settings.provider || "volcengine";
          document.getElementById("chat-model-id").value = settings.chatModelId;
          document.getElementById("coding-model-id").value = settings.codingModelId;
          document.getElementById("api-key").value = settings.apiKey || "";
          const thinkingCheckbox = document.getElementById("thinking-checkbox");
          if (thinkingCheckbox) thinkingCheckbox.checked = settings.thinking !== false;
          updateUI(settings);
        } else if (msg.type === "export-frame-result") {
          const t = translations[settings.language];
          const status = document.getElementById("builder-status");
          if (msg.error) {
            status.textContent = msg.error === "no-selection" ? t.noFrameSelected : t.noFrameSelected;
            status.style.display = "block";
            return;
          }
          if (styleRefs.some((ref) => ref.id === msg.id)) {
            return;
          }
          styleRefs.push({
            id: msg.id,
            name: msg.name,
            imageData: msg.imageData
          });
          updateRefList();
        } else {
          updateUI(settings);
        }
      };
      function updateRefList() {
        const container = document.getElementById("ref-items");
        container.innerHTML = "";
        styleRefs.forEach((ref, index) => {
          const item = document.createElement("div");
          item.className = "ref-item";
          item.innerHTML = `
            <span>${ref.name.substring(0, 6)}</span>
            <span class="remove-btn" data-index="${index}">
                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </span>
        `;
          item.querySelector(".remove-btn").addEventListener("click", () => {
            styleRefs.splice(index, 1);
            updateRefList();
          });
          container.appendChild(item);
        });
      }
      document.getElementById("language").onchange = (e) => {
        settings.language = e.target.value;
        updateUI(settings);
      };
      document.getElementById("save-settings").onclick = () => {
        settings.language = document.getElementById("language").value;
        settings.provider = document.getElementById("provider").value;
        settings.chatModelId = document.getElementById("chat-model-id").value;
        settings.codingModelId = document.getElementById("coding-model-id").value;
        settings.apiKey = document.getElementById("api-key").value;
        settings.thinking = document.getElementById("thinking-checkbox").checked;
        parent.postMessage({ pluginMessage: { type: "save-settings", settings } }, "*");
        const t = translations[settings.language];
        const status = document.getElementById("settings-status");
        status.textContent = t.settingsSaved;
        setTimeout(() => {
          status.textContent = "";
        }, 2e3);
      };
      var copyBtn = document.getElementById("copy-btn");
      copyBtn.onclick = () => {
        if (!lastGeneratedCode) return;
        const textArea = document.createElement("textarea");
        textArea.value = lastGeneratedCode;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand("Copy");
        textArea.remove();
        const originalHTML = copyBtn.innerHTML;
        copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
        setTimeout(() => {
          copyBtn.innerHTML = originalHTML;
        }, 2e3);
      };
      document.getElementById("add-ref-btn").onclick = () => {
        parent.postMessage({ pluginMessage: { type: "export-frame-image" } }, "*");
      };
      document.getElementById("stop-btn").onclick = () => {
        if (abortController) {
          abortController.abort();
        }
      };
      var handleStream = (response, onText) => __async(null, null, function* () {
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let fullText = "";
        let reasoningText = "";
        while (true) {
          const { done, value } = yield reader.read();
          if (done) break;
          const chunk = decoder.decode(value);
          const lines = chunk.split("\n");
          for (const line of lines) {
            if (line.trim().startsWith("data: ")) {
              const dataText = line.trim().slice(6);
              if (dataText === "[DONE]") continue;
              try {
                const data = JSON.parse(dataText);
                const delta = data.choices[0].delta;
                if (delta.reasoning_content) {
                  reasoningText += delta.reasoning_content;
                } else if (delta.content) {
                  fullText += delta.content;
                }
                onText(fullText, reasoningText);
              } catch (e) {
                console.warn("Failed to parse chunk:", dataText);
              }
            }
          }
        }
        return { fullText, reasoningText };
      });
      document.getElementById("expand-btn").onclick = () => __async(null, null, function* () {
        var _a;
        const promptInput = document.getElementById("prompt-input");
        const prompt = promptInput.value;
        const btn = document.getElementById("expand-btn");
        const buildBtn = document.getElementById("build-btn");
        const status = document.getElementById("builder-status");
        const thinkingContainer = document.getElementById("thinking-container");
        const t = translations[settings.language];
        if (!prompt) {
          status.textContent = t.enterDescription;
          return;
        }
        if (!settings.apiKey) {
          status.textContent = t.setApiKey;
          return;
        }
        btn.disabled = true;
        buildBtn.disabled = true;
        btn.classList.add("loading");
        status.textContent = "";
        status.style.display = "none";
        thinkingContainer.classList.add("active");
        document.getElementById("thinking-status").textContent = t.expandingPrompt;
        abortController = new AbortController();
        try {
          const messageContent = [];
          styleRefs.forEach((ref) => {
            messageContent.push({
              type: "image_url",
              image_url: { url: `data:image/png;base64,${ref.imageData}` }
            });
          });
          const styleInstruction = styleRefs.length > 0 ? "[Style Reference: Study the visual style, colors, typography, and layout patterns from the attached image(s). Apply similar aesthetics to the generated requirement, but follow the text instructions for content and structure.]\n\n" : "";
          messageContent.push({ type: "text", text: styleInstruction + prompt });
          const response = yield fetch("https://ark.cn-beijing.volces.com/api/v3/chat/completions", {
            method: "POST",
            signal: abortController.signal,
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${settings.apiKey}`
            },
            body: JSON.stringify({
              model: settings.chatModelId,
              stream: true,
              thinking: document.getElementById("thinking-checkbox").checked ? void 0 : { type: "disabled" },
              messages: [
                {
                  role: "system",
                  content: `You are an expert product manager and UX designer. TASK: Expand the user's short description into a detailed requirement document for a web page design in Figma. Focus on: 1. UI components (e.g., sections, buttons, input fields, text blocks). 2. One or two sentences about the task the user is going to accomplish. IMPORTANT: Do NOT include detailed colors, typography specs, or style descriptions (e.g., "blue gradient", "rounded corners"). Return ONLY the expanded description text, no intro/outro. OUTPUT LANGUAGE: ${settings.language === "zh-CN" ? "Chinese (Simplified)" : "English"}`
                },
                { role: "user", content: messageContent }
              ]
            })
          });
          if (!response.ok) {
            const err = yield response.json();
            throw new Error(((_a = err.error) == null ? void 0 : _a.message) || "API request failed");
          }
          promptInput.value = "";
          yield handleStream(response, (text, reasoning) => {
            if (reasoning) document.getElementById("thinking-status").textContent = t.aiThinking;
            else document.getElementById("thinking-status").textContent = t.generating;
            promptInput.value = text;
            promptInput.scrollTop = promptInput.scrollHeight;
            lastGeneratedCode = text;
            const tokens = Math.floor((reasoning.length + text.length) / 4);
            document.getElementById("token-counter").textContent = `${tokens} ${t.tokens}`;
          });
          status.textContent = t.expanded;
        } catch (err) {
          if (err.name === "AbortError") status.textContent = t.stoppedByUser;
          else status.textContent = `${t.errorPrefix}${err.message}`;
        } finally {
          status.style.display = "block";
          btn.disabled = false;
          buildBtn.disabled = false;
          btn.classList.remove("loading");
          thinkingContainer.classList.remove("active");
          if (lastGeneratedCode) copyBtn.style.display = "flex";
          abortController = null;
        }
      });
      document.getElementById("build-btn").onclick = () => __async(null, null, function* () {
        var _a;
        const prompt = document.getElementById("prompt-input").value;
        const viewport = document.querySelector('input[name="builder-viewport"]:checked').value;
        const btn = document.getElementById("build-btn");
        const expandBtn = document.getElementById("expand-btn");
        const status = document.getElementById("builder-status");
        const thinkingContainer = document.getElementById("thinking-container");
        const t = translations[settings.language];
        if (!prompt) {
          status.textContent = t.enterDescription;
          return;
        }
        if (!settings.apiKey) {
          status.textContent = t.setApiKey;
          return;
        }
        btn.disabled = true;
        expandBtn.disabled = true;
        btn.classList.add("loading");
        status.textContent = "";
        status.style.display = "none";
        copyBtn.style.display = "none";
        thinkingContainer.classList.add("active");
        document.getElementById("thinking-status").textContent = t.contactingAI;
        abortController = new AbortController();
        const viewportDesc = viewport === "mobile" ? "Target Viewport: Mobile (375px width). Use single-column layouts, larger touch targets, and vertical stacking." : "Target Viewport: Desktop (1440px width). Use multi-column layouts, horizontal alignment, and whitespace effectively.";
        try {
          const messageContent = [];
          styleRefs.forEach((ref) => {
            messageContent.push({
              type: "image_url",
              image_url: { url: `data:image/png;base64,${ref.imageData}` }
            });
          });
          const styleInstruction = styleRefs.length > 0 ? `[Style Reference: Study the visual style, colors, typography, and layout patterns from the attached image(s). Apply similar aesthetics to the generated design, but follow the text instructions for content and structure. Ensure all text in the generated HTML is in ${settings.language === "zh-CN" ? "Chinese" : "English"}.]

` : "";
          messageContent.push({ type: "text", text: styleInstruction + prompt });
          const response = yield fetch("https://ark.cn-beijing.volces.com/api/v3/chat/completions", {
            method: "POST",
            signal: abortController.signal,
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${settings.apiKey}`
            },
            body: JSON.stringify({
              model: settings.codingModelId,
              stream: true,
              thinking: document.getElementById("thinking-checkbox").checked ? void 0 : { type: "disabled" },
              messages: [
                {
                  role: "system",
                  content: `You are an elite UI engineer. TASK: Generate a standalone HTML snippet using Tailwind CSS classes based on the user description. ${viewportDesc} RULES: 1. Only return code, no markdown block wrappers. 2. Use modern, premium aesthetics. 3. Ensure full responsiveness. 4. Use Font Awesome icons where appropriate (fa-solid fa-icon) and vibrant colors. 5. Include decent padding and gap for a clean look. 6. Content Language: ${settings.language === "zh-CN" ? "Chinese (Simplified)" : "English"}. Ensure all text in the generated HTML is in ${settings.language === "zh-CN" ? "Chinese" : "English"}. 7. IMPORTANT: Strictly AVOID using standard CSS or inline style="" attributes. Use ONLY pure Tailwind CSS utility classes. 8. Enclose ALL background colors and specific styling in Tailwind arbitrary value classes (e.g., bg-[#123456], text-[#abcdef]) directly in the class names. 9. AVOID using CSS Grid. Always prefer Flexbox for all layouts to ensure compatibility with Figma Auto Layout. Explicitly specify flex direction using 'flex-row' (preferred/default) or 'flex-col' for all flex containers. Use Grid ONLY as a last resort for extremely complex 2D structures.`
                },
                { role: "user", content: messageContent }
              ]
            })
          });
          if (!response.ok) {
            const err = yield response.json();
            throw new Error(((_a = err.error) == null ? void 0 : _a.message) || "API request failed");
          }
          const { fullText: fullHtml } = yield handleStream(response, (text, reasoning) => {
            if (reasoning) document.getElementById("thinking-status").textContent = t.aiThinking;
            else document.getElementById("thinking-status").textContent = t.generating;
            const tokens = Math.floor((reasoning.length + text.length) / 4);
            document.getElementById("token-counter").textContent = `${tokens} ${t.tokens}`;
            lastGeneratedCode = text;
          });
          let html = fullHtml.trim();
          html = html.replace(/^```html\n?/, "").replace(/\n?```$/, "");
          document.getElementById("thinking-status").textContent = t.buildingLayers;
          const iconMap = yield getIconsMap(html);
          status.textContent = t.buildingLayers;
          parent.postMessage({ pluginMessage: { type: "convert-html", html, viewport, icons: iconMap } }, "*");
          status.textContent = t.buildComplete;
        } catch (err) {
          if (err.name === "AbortError") status.textContent = t.generationStopped;
          else status.textContent = `${t.errorPrefix}${err.message}`;
        } finally {
          status.style.display = "block";
          btn.disabled = false;
          expandBtn.disabled = false;
          btn.classList.remove("loading");
          thinkingContainer.classList.remove("active");
          if (lastGeneratedCode) copyBtn.style.display = "flex";
          abortController = null;
        }
      });
      document.getElementById("figma-to-tailwind-btn").onclick = () => {
        const status = document.getElementById("tailwind-status");
        const t = translations[settings.language];
        status.textContent = t.converting;
        parent.postMessage({ pluginMessage: { type: "figma-to-tailwind" } }, "*");
      };
      document.getElementById("convert").onclick = () => __async(null, null, function* () {
        const html = document.getElementById("html-input").value;
        const viewport = document.querySelector('input[name="viewport"]:checked').value;
        const status = document.getElementById("tailwind-status");
        const t = translations[settings.language];
        if (!html) return;
        status.textContent = t.processingIcons;
        const iconMap = yield getIconsMap(html);
        parent.postMessage({ pluginMessage: { type: "convert-html", html, viewport, icons: iconMap } }, "*");
        status.textContent = t.sentToFigma;
        setTimeout(() => {
          status.textContent = "";
        }, 2e3);
      });
    }
  });
  require_main();
})();

  </script>
</body>

</html>